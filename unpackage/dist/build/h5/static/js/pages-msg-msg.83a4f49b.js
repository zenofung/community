(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-msg-msg"],{"05c4":function(n,t,e){"use strict";e.r(t);var a=e("a5cf"),i=e.n(a);for(var s in a)"default"!==s&&function(n){e.d(t,n,(function(){return a[n]}))}(s);t["default"]=i.a},2909:function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var a=r(e("6005")),i=r(e("db90")),s=r(e("06c5")),o=r(e("3427"));function r(n){return n&&n.__esModule?n:{default:n}}function u(n){return(0,a.default)(n)||(0,i.default)(n)||(0,s.default)(n)||(0,o.default)()}},3239:function(n,t,e){"use strict";e.r(t);var a=e("f67b"),i=e("05c4");for(var s in i)"default"!==s&&function(n){e.d(t,n,(function(){return i[n]}))}(s);e("f502");var o,r=e("f0c5"),u=Object(r["a"])(i["default"],a["b"],a["c"],!1,null,"e4daf9fe",null,!1,a["a"],o);t["default"]=u.exports},3427:function(n,t,e){"use strict";function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},"5a3b":function(n,t,e){var a=e("a7fd");"string"===typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);var i=e("4f06").default;i("4eeb7d3a",a,!0,{sourceMap:!1,shadowMode:!1})},6005:function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var a=i(e("6b75"));function i(n){return n&&n.__esModule?n:{default:n}}function s(n){if(Array.isArray(n))return(0,a.default)(n)}},a5cf:function(n,t,e){"use strict";var a=e("4ea4");e("99af"),e("4160"),e("d3b7"),e("159b"),e("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(e("3835")),s=a(e("b85c")),o=a(e("2909")),r=e("aded"),u=e("b834"),l={data:function(){return{listFlag:!1,page:1,totalPage:0,imMessageList:[],timer:null}},onShow:function(){var n=this;this.listFlag=!1,this.page=1,this.totalPage=0,this.$myRequest({url:"/immessagelist/list",methed:"get",data:{limit:5,page:1,userId:this.$user.id}}).then((function(t){console.log("列表数据",t),n.$data.imMessageList=t.data.page.list,n.totalPage=t.data.page.totalPage}))},onReachBottom:function(){var n=this;console.log("上拉",this.totalPage),this.totalPage<this.page+1?uni.showToast({title:"暂无更多",icon:"none",duration:850}):(this.page=this.page+1,this.$myRequest({url:"/immessagelist/list",methed:"get",data:{limit:5,page:this.page,userId:this.$user.id}}).then((function(t){console.log("下拉返回数据",t),t.data.page.list.length<5&&(n.listFlag=!0),n.imMessageList=[].concat((0,o.default)(n.imMessageList),(0,o.default)(t.data.page.list))})))},onLoad:function(){var n=this;(0,u.login)(this.$user.id),uni.onSocketMessage((function(t){var e=JSON.parse(t.data);console.log("主界面接收",e),"1"==e.msg||"0"==e.msg?n.logins(e):"2"==e.msg&&(uni.$emit("message",e.content),console.log(e.content.imMagListId),n.imMessageList.forEach((function(n,t){n.id==e.content.imMagListId&&(n.unread=n.unread+1,console.log(n,t),n.imMessageEntityLast=e.content)})))}))},destroyed:function(){(0,u.quit)()},methods:{logins:function(n){console.log("好友登录",n);var t,e=(0,s.default)(this.$data.imMessageList.entries());try{for(e.s();!(t=e.n()).done;){var a=(0,i.default)(t.value,2),o=a[0],r=a[1];n.loginUser.id==r.userVo.id&&(this.$set(this.$data.imMessageList[o],"onLine",n.loginUser.loginStatus),console.log(this.$data.imMessageList[o]))}}catch(u){e.e(u)}finally{e.f()}},toMsgChat:function(n){console.log(n),uni.navigateTo({url:"/pages/msg/msg_chat/msg_chat?data="+n})},timestampFormat:function(n){return r.articleUtil.timestampFormat(n)},notice:function(){uni.navigateTo({url:"/pages/msg/msg_inform/msg_inform"})},toLogistics:function(){uni.navigateTo({url:"/pages/msg/msg_logistics_all/msg_logistics_all"})}}};t.default=l},a7fd:function(n,t,e){var a=e("24fb");t=a(!1),t.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* pages/message/message.wxss */\n/* \x3c!-- 头部消息 --\x3e */.bc[data-v-e4daf9fe]{width:100%;height:%?200?%;background:linear-gradient(10deg,#ffe1ff,#1cbbb4)}.txt_1[data-v-e4daf9fe]{margin-left:%?30?%;color:#fff}.kuai[data-v-e4daf9fe]{width:%?700?%;height:%?200?%;background-color:#fff;margin-top:%?50?%;margin-left:%?25?%;border-radius:%?50?%;box-shadow:%?3?% %?3?% %?3?% %?3?% hsla(0,0%,50.2%,.384);display:flex;flex-direction:row}.interactive[data-v-e4daf9fe]{display:flex;flex-direction:column;font-size:%?30?%;color:#000;width:%?130?%;height:%?150?%;margin-top:%?60?%;margin-left:%?100?%}.imgs[data-v-e4daf9fe]{margin-left:%?10?%;width:%?80?%;height:%?80?%}.notice[data-v-e4daf9fe]{display:flex;flex-direction:column;font-size:%?30?%;color:#000;width:%?130?%;height:%?150?%;margin-top:%?60?%;margin-left:%?100?%}.logistics[data-v-e4daf9fe]{display:flex;flex-direction:column;font-size:%?30?%;color:#000;width:%?130?%;height:%?150?%;margin-top:%?60?%;margin-left:%?80?%}\n/* \x3c!-- 头部消息end --\x3e */\n/* 聊天消息 */.martop[data-v-e4daf9fe]{margin-top:%?115?%}\n/* 聊天消息end */",""]),n.exports=t},aded:function(n,t,e){"use strict";e("e25e"),Object.defineProperty(t,"__esModule",{value:!0}),t.articleUtil=void 0;var a={timestampFormat:function(n){if(!n)return"";n=new Date(n).getTime()/1e3;function t(n){return(1==String(n).length?"0":"")+n}var e=parseInt((new Date).getTime()/1e3),a=e-n,i=new Date(1e3*e),s=new Date(1e3*n),o=s.getFullYear(),r=s.getMonth()+1,u=s.getDate(),l=s.getHours(),c=s.getMinutes();s.getSeconds();if(a<60)return"刚刚";if(a<3600)return Math.floor(a/60)+"分钟前";if(i.getFullYear()==o&&i.getMonth()+1==r&&i.getDate()==u)return"今天"+t(l)+":"+t(c);var d=new Date(1e3*(e-86400));return d.getFullYear()==o&&d.getMonth()+1==r&&d.getDate()==u?"昨天"+t(l)+":"+t(c):i.getFullYear()==o?t(r)+"月"+t(u)+"日 "+t(l)+":"+t(c):o+"年"+t(r)+"月"+t(u)+"日 "+t(l)+":"+t(c)},clickThumbsup:function(n,t){var e=this;this.$set(this.$data.article.commentEntity[t],"praiseStatus",!this.$data.article.commentEntity[t].praiseStatus),this.$data.article.commentEntity[t].praiseStatus&&this.$myRequest({url:"/commentpraise/save",method:"post",data:{userId:this.$user.id,commentId:n}}).then((function(n){0==n.data.code&&e.$set(e.$data.article.commentEntity[t],"praises",e.$data.article.commentEntity[t].praises+1)})),this.$data.article.commentEntity[t].praiseStatus||this.$myRequest({url:"/commentpraise/delete",method:"post",data:{userId:this.$user.id,commentId:n}}).then((function(n){0==n.data.code&&e.$set(e.$data.article.commentEntity[t],"praises",e.$data.article.commentEntity[t].praises-1)})),console.log(this.$data.article.commentEntity[t].praiseStatus),console.log("childThumbsup")}};t.articleUtil=a},b834:function(n,t,e){"use strict";e("d3b7"),Object.defineProperty(t,"__esModule",{value:!0}),t.login=i,t.quit=o,t.onSocketMessage=s,t.sendSocketMessage=r;var a=null;function i(n){var t={status:1,content:{id:n,content:"login"}},e={status:"0"};return uni.connectSocket({url:"wss://www.homiesocial.cn/webSocket"}),uni.onSocketOpen((function(n){a=setInterval((function(){r(e)}),6e3),r(t)})),Promise.resolve("ok")}function s(){uni.onSocketMessage((function(n){return JSON.parse(n.data)}))}function o(){uni.onSocketClose((function(n){clearInterval(a),a=null,console.log("WebSocket 已关闭！")}))}function r(n){return uni.sendSocketMessage({data:JSON.stringify(n)})}},b85c:function(n,t,e){"use strict";e("a4d3"),e("e01a"),e("d28b"),e("d3b7"),e("3ca3"),e("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var a=i(e("06c5"));function i(n){return n&&n.__esModule?n:{default:n}}function s(n,t){var e;if("undefined"===typeof Symbol||null==n[Symbol.iterator]){if(Array.isArray(n)||(e=(0,a.default)(n))||t&&n&&"number"===typeof n.length){e&&(n=e);var i=0,s=function(){};return{s:s,n:function(){return i>=n.length?{done:!0}:{done:!1,value:n[i++]}},e:function(n){throw n},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,u=!1;return{s:function(){e=n[Symbol.iterator]()},n:function(){var n=e.next();return r=n.done,n},e:function(n){u=!0,o=n},f:function(){try{r||null==e["return"]||e["return"]()}finally{if(u)throw o}}}}},db90:function(n,t,e){"use strict";function a(n){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(n))return Array.from(n)}e("a4d3"),e("e01a"),e("d28b"),e("a630"),e("d3b7"),e("3ca3"),e("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},f502:function(n,t,e){"use strict";var a=e("5a3b"),i=e.n(a);i.a},f67b:function(n,t,e){"use strict";var a;e.d(t,"b",(function(){return i})),e.d(t,"c",(function(){return s})),e.d(t,"a",(function(){return a}));var i=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("v-uni-view",[e("v-uni-view",{staticClass:"contentbottom cu-list menu-avatar  card-menu martop content"},n._l(n.imMessageList,(function(t){return e("v-uni-view",{key:t.id,staticClass:"cu-item ",class:{grayscale:0==t.onLine},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.toMsgChat(t.id)}}},[e("v-uni-view",{staticClass:"cu-avatar round lg",staticStyle:{"background-image":"url(https://ossweb-img.qq.com/images/lol/web201310/skin/big10001.jpg)"},style:{"background-image":"url("+t.userVo.userProtrait+")"}}),e("v-uni-view",{staticClass:"content"},[e("v-uni-view",{staticClass:"text-grey"},[n._v(n._s(t.userVo.userNikename))]),e("v-uni-view",{staticClass:"cu-tag round bg-orange sm",style:{display:0==t.onLine?"":"none"}},[n._v("断开连接...")]),e("v-uni-view",{staticClass:"text-gray text-sm flex"},[e("v-uni-text",{staticClass:"text-cut"},[n._v(n._s(t.imMessageEntityLast.magContent?t.imMessageEntityLast.magContent:""))])],1)],1),e("v-uni-view",{staticClass:"action"},[e("v-uni-view",{staticClass:"text-grey text-xs"},[n._v(n._s(n.timestampFormat(t.imMessageEntityLast.createTime)))]),e("v-uni-view",{staticClass:"cu-tag round bg-red sm",style:{display:0==t.unread?"none":""}},[n._v(n._s(t.unread))])],1)],1)})),1)],1)},s=[]}}]);